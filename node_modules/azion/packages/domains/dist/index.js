"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var d=process.env.AZION_ENV==="stage"?"https://stage-api.azion.net/domains":"https://api.azionapi.net/domains",p=(s,i)=>{let n;return s.forEach(e=>{i[e]&&(n=Array.isArray(i[e])?i[e].join(", "):i[e])}),_nullishCoalesce(n, () => (JSON.stringify(i)))},u=s=>({Authorization:`Token ${s}`,Accept:"application/json; version=3","Content-Type":"application/json"}),g=async(s,i,{debug:n})=>{try{let e={name:i.name,cnames:_nullishCoalesce(_optionalChain([i, 'optionalAccess', _2 => _2.cnames]), () => ([])),cname_access_only:_nullishCoalesce(_optionalChain([i, 'optionalAccess', _3 => _3.cnameAccessOnly]), () => (!1)),digital_certificate_id:_nullishCoalesce(_optionalChain([i, 'optionalAccess', _4 => _4.digitalCertificateId]), () => (void 0)),edge_application_id:i.edgeApplicationId,edge_firewall_id:_nullishCoalesce(_optionalChain([i, 'optionalAccess', _5 => _5.edgeFirewallId]), () => (void 0)),is_active:!0};if(_optionalChain([i, 'optionalAccess', _6 => _6.mtls])){if(i.mtls.verification!=="enforce"&&i.mtls.verification!=="permissive")throw new Error("mtls.verification must be enforce or permissive");e={...e,is_mtls_enabled:!0,mtls_verification:i.mtls.verification,mtls_trusted_ca_certificate_id:i.mtls.trustedCaCertificateId,crl_list:i.mtls.crlList}}let r=await(await fetch(d,{method:"POST",headers:u(s),body:JSON.stringify(e)})).json();return n&&console.log("Response Post Domains",r),r.results?r:{error:{message:p(["detail","edge_application_id"],r),operation:"create domain"}}}catch(e){throw n&&console.error("Error creating Domain:",e),e}},A=async(s,i,n)=>{try{let{page_size:e=10,page:t=1}=n||{},r=new URLSearchParams({page_size:String(e),page:String(t)}),m=await(await fetch(`${d}?${r.toString()}`,{method:"GET",headers:u(s)})).json();return _optionalChain([i, 'optionalAccess', _7 => _7.debug])&&console.log("Response List Domains",m),m.results?{...m,results:m.results.map(o=>({id:o.id,name:o.name,url:o.domain_name,environment:o.environment,active:o.is_active,edgeApplicationId:o.edge_application_id,cnameAccessOnly:o.cname_access_only,digitalCertificateId:o.digital_certificate_id,edgeFirewallId:_optionalChain([o, 'optionalAccess', _8 => _8.edge_firewall_id]),cnames:o.cnames,mtls:o.is_mtls_enabled?{verification:o.mtls_verification,trustedCaCertificateId:o.mtls_trusted_ca_certificate_id,crlList:o.crl_list}:void 0}))}:{error:{message:p(["detail","edge_application_id"],m),operation:"list domains"}}}catch(e){throw _optionalChain([i, 'optionalAccess', _9 => _9.debug])&&console.error("Error listing Domains:",e),e}},_=async(s,i,n)=>{try{let t=await(await fetch(`${d}/${i}`,{method:"GET",headers:u(s)})).json();return _optionalChain([n, 'optionalAccess', _10 => _10.debug])&&console.log("Response Get Domain",t),t.results?t:{error:{message:p(["detail","edge_application_id"],t),operation:"get domain"}}}catch(e){throw _optionalChain([n, 'optionalAccess', _11 => _11.debug])&&console.error("Error getting Domain:",e),e}},f=async(s,i,n,e)=>{try{let t={name:n.name,cnames:_nullishCoalesce(_optionalChain([n, 'optionalAccess', _12 => _12.cnames]), () => ([])),cname_access_only:_nullishCoalesce(_optionalChain([n, 'optionalAccess', _13 => _13.cnameAccessOnly]), () => (!1)),digital_certificate_id:_nullishCoalesce(_optionalChain([n, 'optionalAccess', _14 => _14.digitalCertificateId]), () => (void 0)),edge_application_id:n.edgeApplicationId,edge_firewall_id:_nullishCoalesce(_optionalChain([n, 'optionalAccess', _15 => _15.edgeFirewallId]), () => (void 0)),is_active:_nullishCoalesce(n.active, () => (!0))};if(_optionalChain([n, 'optionalAccess', _16 => _16.mtls])){if(n.mtls.verification!=="enforce"&&n.mtls.verification!=="permissive")throw new Error("mtls.verification must be enforce or permissive");t={...t,is_mtls_enabled:!0,mtls_verification:n.mtls.verification,mtls_trusted_ca_certificate_id:n.mtls.trustedCaCertificateId,crl_list:n.mtls.crlList}}let c=await(await fetch(`${d}/${i}`,{method:"PUT",headers:u(s),body:JSON.stringify(t)})).json();return _optionalChain([e, 'optionalAccess', _17 => _17.debug])&&console.log("Response Put Domains",c),c.results?c:{error:{message:p(["detail","edge_application_id"],c),operation:"update domain"}}}catch(t){throw _optionalChain([e, 'optionalAccess', _18 => _18.debug])&&console.error("Error updating Domain:",t),t}},D=async(s,i,n)=>{try{let e=await fetch(`${d}/${i}`,{method:"DELETE",headers:u(s)});if(e.status!==204){let t=await e.json();return{error:{message:p(["detail","edge_application_id"],t),operation:"delete domain"}}}return _optionalChain([n, 'optionalAccess', _19 => _19.debug])&&console.log("Response Delete Domain"),{results:void 0}}catch(e){throw _optionalChain([n, 'optionalAccess', _20 => _20.debug])&&console.error("Error deleting Domain:",e),e}};var a=s=>_nullishCoalesce(_nullishCoalesce(s, () => (process.env.AZION_TOKEN)), () => ("")),l=s=>{let i=process.env.AZION_DEBUG&&process.env.AZION_DEBUG==="true";return typeof s>"u"||s===null?!!i:!!s};var z=async(s,i,n)=>{if(i.name===void 0||i.edgeApplicationId===void 0)return{error:{message:"Domain name and Edge Application ID are required",operation:"create domain"}};let{results:e,error:t}=await g(a(s),i,{...n,debug:l(_optionalChain([n, 'optionalAccess', _21 => _21.debug]))});return e&&e.id?{data:{state:"executed",id:e.id,name:_optionalChain([e, 'optionalAccess', _22 => _22.name]),url:_optionalChain([e, 'optionalAccess', _23 => _23.domain_name]),environment:_optionalChain([e, 'optionalAccess', _24 => _24.environment]),active:_optionalChain([e, 'optionalAccess', _25 => _25.is_active])}}:{error:t}},b=async(s,i,n)=>{let e=await A(a(s),n,i);return e.results?{data:{count:_nullishCoalesce(e.count, () => (e.results.length)),state:"executed",results:e.results,pages:_nullishCoalesce(e.total_pages, () => (1))}}:{error:e.error}},C=async(s,i,n)=>{let{results:e,error:t}=await _(a(s),i,{...n,debug:l(_optionalChain([n, 'optionalAccess', _26 => _26.debug]))});return e&&e.id?{data:{state:"executed",id:e.id,name:_optionalChain([e, 'optionalAccess', _27 => _27.name]),url:_optionalChain([e, 'optionalAccess', _28 => _28.domain_name]),environment:_optionalChain([e, 'optionalAccess', _29 => _29.environment]),active:_optionalChain([e, 'optionalAccess', _30 => _30.is_active]),cnameAccessOnly:_optionalChain([e, 'optionalAccess', _31 => _31.cname_access_only]),digitalCertificateId:_optionalChain([e, 'optionalAccess', _32 => _32.digital_certificate_id]),cnames:_optionalChain([e, 'optionalAccess', _33 => _33.cnames]),edgeApplicationId:_optionalChain([e, 'optionalAccess', _34 => _34.edge_application_id]),edgeFirewallId:_optionalChain([e, 'optionalAccess', _35 => _35.edge_firewall_id]),mtls:_optionalChain([e, 'optionalAccess', _36 => _36.is_mtls_enabled])?{verification:e.mtls_verification,trustedCaCertificateId:e.mtls_trusted_ca_certificate_id,crlList:e.crl_list}:void 0}}:{error:t}},y=async(s,i,n,e)=>{if(_optionalChain([n, 'optionalAccess', _37 => _37.edgeApplicationId])===void 0)return{error:{message:"Edge Application ID is required",operation:"update domain"}};let t=await f(a(s),i,n,{...e,debug:l(_optionalChain([e, 'optionalAccess', _38 => _38.debug]))});return _optionalChain([t, 'optionalAccess', _39 => _39.results, 'optionalAccess', _40 => _40.id])?{data:{state:"executed",name:_optionalChain([t, 'optionalAccess', _41 => _41.results, 'optionalAccess', _42 => _42.name]),id:_optionalChain([t, 'optionalAccess', _43 => _43.results, 'optionalAccess', _44 => _44.id]),environment:_optionalChain([t, 'optionalAccess', _45 => _45.results, 'optionalAccess', _46 => _46.environment]),cnames:_optionalChain([t, 'optionalAccess', _47 => _47.results, 'optionalAccess', _48 => _48.cnames]),url:_optionalChain([t, 'optionalAccess', _49 => _49.results, 'optionalAccess', _50 => _50.domain_name]),active:_optionalChain([t, 'optionalAccess', _51 => _51.results, 'optionalAccess', _52 => _52.is_active]),cnameAccessOnly:_optionalChain([t, 'optionalAccess', _53 => _53.results, 'optionalAccess', _54 => _54.cname_access_only]),digitalCertificateId:_optionalChain([t, 'optionalAccess', _55 => _55.results, 'optionalAccess', _56 => _56.digital_certificate_id]),edgeApplicationId:_optionalChain([t, 'optionalAccess', _57 => _57.results, 'optionalAccess', _58 => _58.edge_application_id]),edgeFirewallId:_optionalChain([t, 'optionalAccess', _59 => _59.results, 'optionalAccess', _60 => _60.edge_firewall_id]),mtls:_optionalChain([t, 'optionalAccess', _61 => _61.results, 'optionalAccess', _62 => _62.is_mtls_enabled])?{verification:_optionalChain([t, 'optionalAccess', _63 => _63.results, 'access', _64 => _64.mtls_verification]),trustedCaCertificateId:_optionalChain([t, 'optionalAccess', _65 => _65.results, 'access', _66 => _66.mtls_trusted_ca_certificate_id]),crlList:_optionalChain([t, 'optionalAccess', _67 => _67.results, 'access', _68 => _68.crl_list])}:void 0}}:{error:_optionalChain([t, 'optionalAccess', _69 => _69.error])}},v=async(s,i,n)=>{let{error:e}=await D(a(s),i,{...n,debug:l(_optionalChain([n, 'optionalAccess', _70 => _70.debug]))});return e?{error:e}:{data:{state:"executed",id:i}}},P= exports.createDomain =async(s,i)=>z(a(),s,i),E= exports.getDomains =async(s,i)=>b(a(),i,s),L= exports.getDomain =async(s,i)=>C(a(),s,i),S= exports.updateDomain =async(s,i,n)=>y(a(),s,i,n),T= exports.deleteDomain =async(s,i)=>v(a(),s,i),h= exports.createClient =s=>{let i=a(_optionalChain([s, 'optionalAccess', _71 => _71.token])),n=l(_optionalChain([s, 'optionalAccess', _72 => _72.options, 'optionalAccess', _73 => _73.debug]));return{createDomain:(t,r)=>z(i,t,{...r,debug:n}),getDomains:(t,r)=>b(i,r,{...t,debug:n}),getDomain:(t,r)=>C(i,t,{...r,debug:n}),updateDomain:(t,r,c)=>y(i,t,r,{...c,debug:n}),deleteDomain:(t,r)=>v(i,t,{...r,debug:n})}};var x=h;exports.createClient = h; exports.createDomain = P; exports.default = x; exports.deleteDomain = T; exports.getDomain = L; exports.getDomains = E; exports.updateDomain = S;
