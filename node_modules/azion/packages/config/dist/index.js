"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _ajv = require('ajv'); var _ajv2 = _interopRequireDefault(_ajv);var _ajverrors = require('ajv-errors'); var _ajverrors2 = _interopRequireDefault(_ajverrors);var _ajvkeywords = require('ajv-keywords'); var _ajvkeywords2 = _interopRequireDefault(_ajvkeywords);function x(r){let i={...r},t=["httpToHttps","bypassCache","forwardCookies","capture","setOrigin","rewrite","setCookie","setHeaders","runFunction","setCache","redirectTo301","redirectTo302","deliver"],s=["enableGZIP","capture","setCookie","setHeaders","filterHeader","filterCookie","runFunction","redirectTo301","redirectTo302","deliver"],e=(a,n)=>a.map(o=>{let p={...o,behavior:{...o.behavior}};return Object.keys(o).forEach(d=>{n.includes(d)&&(p.behavior[d]=o[d],delete p[d])}),p});return i.rules&&i.rules.request&&(i.rules.request=e(i.rules.request,t)),i.rules&&i.rules.response&&(i.rules.response=e(i.rules.response,s)),i}var T=x;var B={type:"object",properties:{build:{type:"object",properties:{entry:{type:"string",errorMessage:"The 'entry' field must be a string representing the entry point file path."},builder:{type:["string","null"],enum:["esbuild","webpack",null],errorMessage:"The 'builder' field must be either 'esbuild', 'webpack', or null."},polyfills:{type:"boolean",errorMessage:"The 'polyfills' field must be a boolean."},worker:{type:"boolean",errorMessage:"The 'worker' field must be a boolean."},preset:{type:"object",properties:{name:{type:"string",errorMessage:"The 'preset.name' field must be a string."}},required:["name"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'preset' object.",required:"The 'name' and 'mode' fields are required in the 'preset' object."}},memoryFS:{type:"object",properties:{injectionDirs:{type:["array","null"],items:{type:"string"},errorMessage:"The 'memoryFS.injectionDirs' field must be an array of strings or null."},removePathPrefix:{type:["string","null"],errorMessage:"The 'memoryFS.removePathPrefix' field must be a string or null."}},additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'memoryFS' object."}},custom:{type:"object",additionalProperties:!0,errorMessage:"The 'custom' field must be an object."}},additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'build' object."}},origin:{type:"array",items:{type:"object",properties:{id:{type:"integer",errorMessage:"The 'id' field must be a number."},key:{type:"string",errorMessage:"The 'key' field must be a string."},name:{type:"string",errorMessage:"The 'name' field must be a string."},type:{type:"string",enum:["single_origin","object_storage","load_balancer","live_ingest"],errorMessage:"The 'type' field must be a string and one of 'single_origin', 'object_storage', 'load_balancer' or 'live_ingest'."},bucket:{type:["string","null"],errorMessage:"The 'bucket' field must be a string or null."},prefix:{type:["string","null"],errorMessage:"The 'prefix' field must be a string or null."},addresses:{anyOf:[{type:"array",items:{type:"string"},errorMessage:{type:"The 'addresses' field must be an array of strings."}},{type:"array",items:{type:"object",properties:{address:{type:"string",errorMessage:"The 'address' field must be a string."},weight:{type:"integer"}},required:["address"],additionalProperties:!1,errorMessage:{type:"The 'addresses' field must be an array of objects.",additionalProperties:"No additional properties are allowed in address items.",required:"The 'address' field is required in each address item."}}}]},hostHeader:{type:"string",errorMessage:"The 'hostHeader' field must be a string."},protocolPolicy:{type:"string",enum:["preserve","http","https"],errorMessage:"The 'protocolPolicy' field must be either 'http', 'https' or 'preserve'. Default is 'preserve'."},redirection:{type:"boolean",errorMessage:"The 'redirection' field must be a boolean."},method:{type:"string",enum:["ip_hash","least_connections","round_robin"],errorMessage:"The 'method' field must be either 'ip_hash', 'least_connections' or 'round_robin'. Default is 'ip_hash'."},path:{type:"string",errorMessage:"The 'path' field must be a string."},connectionTimeout:{type:"integer",errorMessage:"The 'connectionTimeout' field must be a number. Default is 60."},timeoutBetweenBytes:{type:"integer",errorMessage:"The 'timeoutBetweenBytes' field must be a number. Default is 120."},hmac:{type:"object",properties:{region:{type:"string",errorMessage:"The 'region' field must be a string."},accessKey:{type:"string",errorMessage:"The 'accessKey' field must be a string."},secretKey:{type:"string",errorMessage:"The 'secretKey' field must be a string."}},required:["region","accessKey","secretKey"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the hmac object.",required:"The 'region, accessKey and secretKey' fields are required in the hmac object."}}},required:["name","type"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in origin item objects.",required:"The 'name and type' field is required in each origin item."}},errorMessage:{additionalProperties:"The 'origin' field must be an array of objects."}},cache:{type:"array",items:{type:"object",properties:{name:{type:"string",errorMessage:"The 'name' field must be a string."},stale:{type:"boolean",errorMessage:"The 'stale' field must be a boolean."},queryStringSort:{type:"boolean",errorMessage:"The 'queryStringSort' field must be a boolean."},methods:{type:"object",properties:{post:{type:"boolean",errorMessage:"The 'post' field must be a boolean."},options:{type:"boolean",errorMessage:"The 'options' field must be a boolean."}},additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'methods' object."}},browser:{type:"object",properties:{maxAgeSeconds:{oneOf:[{type:"number",errorMessage:"The 'maxAgeSeconds' field must be a number or a valid mathematical expression."},{type:"string",pattern:"^[0-9+*/.() -]+$",errorMessage:"The 'maxAgeSeconds' field must be a valid mathematical expression."}]}},required:["maxAgeSeconds"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'browser' object.",required:"The 'maxAgeSeconds' field is required in the 'browser' object."}},edge:{type:"object",properties:{maxAgeSeconds:{oneOf:[{type:"number",errorMessage:"The 'maxAgeSeconds' field must be a number or a valid mathematical expression."},{type:"string",pattern:"^[0-9+*/.() -]+$",errorMessage:"The 'maxAgeSeconds' field must be a valid mathematical expression."}]}},required:["maxAgeSeconds"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'edge' object.",required:"The 'maxAgeSeconds' field is required in the 'edge' object."}},cacheByCookie:{type:"object",properties:{option:{type:"string",enum:["ignore","varies","whitelist","blacklist"],errorMessage:"The 'option' field must be one of 'ignore', 'varies', 'whitelist' or 'blacklist'.."},list:{type:"array",items:{type:"string",errorMessage:"Each item in 'list' must be a string."},errorMessage:{type:"The 'list' field must be an array of strings."}}},required:["option"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'cacheByCookie' object.",required:"The 'option' field is required in the 'cacheByCookie' object."},if:{properties:{option:{enum:["whitelist","blacklist"]}}},then:{required:["list"],errorMessage:{required:"The 'list' field is required when 'option' is 'whitelist' or 'blacklist'."}}},cacheByQueryString:{type:"object",properties:{option:{type:"string",enum:["ignore","varies","whitelist","blacklist"],errorMessage:"The 'option' field must be one of 'ignore', 'varies', 'whitelist' or 'blacklist'."},list:{type:"array",items:{type:"string",errorMessage:"Each item in 'list' must be a string."},errorMessage:{type:"The 'list' field must be an array of strings."}}},required:["option"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'cacheByQueryString' object.",required:"The 'option' field is required in the 'cacheByQueryString' object."},if:{properties:{option:{enum:["whitelist","blacklist"]}}},then:{required:["list"],errorMessage:{required:"The 'list' field is required when 'option' is 'whitelist' or 'blacklist'."}}}},required:["name"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in cache item objects.",required:"The 'name' field is required in each cache item."}},errorMessage:{additionalProperties:"The 'cache' field must be an array of objects."}},rules:{type:"object",properties:{request:{type:"array",items:{type:"object",properties:{name:{type:"string",errorMessage:"The 'name' field must be a string."},description:{type:"string",errorMessage:"The 'description' field must be a string."},active:{type:"boolean",default:!0,errorMessage:"The 'active' field must be a boolean."},match:{type:"string",errorMessage:"The 'match' field must be a string."},variable:{type:"string",errorMessage:"The 'variable' field must be a string."},behavior:{type:"object",properties:{setOrigin:{type:"object",properties:{name:{type:"string",errorMessage:"The 'name' field must be a string."},type:{type:"string",errorMessage:"The 'type' field must be a string."}},required:["name","type"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'setOrigin' object.",required:"The 'name or type' field is required in the 'setOrigin' object."}},rewrite:{type:"string",errorMessage:"The 'rewrite' field must be a string."},setHeaders:{type:"array",items:{type:"string",errorMessage:"Each item in 'setHeaders' must be a string."},errorMessage:{type:"The 'setHeaders' field must be an array of strings."}},bypassCache:{type:["boolean","null"],errorMessage:"The 'bypassCache' field must be a boolean or null."},httpToHttps:{type:["boolean","null"],errorMessage:"The 'httpToHttps' field must be a boolean or null."},redirectTo301:{type:["string","null"],errorMessage:"The 'redirectTo301' field must be a string or null."},redirectTo302:{type:["string","null"],errorMessage:"The 'redirectTo302' field must be a string or null."},forwardCookies:{type:["boolean","null"],errorMessage:"The 'forwardCookies' field must be a boolean or null."},setCookie:{type:["string","null"],errorMessage:"The 'setCookie' field must be a string or null."},deliver:{type:["boolean","null"],errorMessage:"The 'deliver' field must be a boolean or null."},capture:{type:"object",properties:{match:{type:"string",errorMessage:"The 'match' field must be a string."},captured:{type:"string",errorMessage:"The 'captured' field must be a string."},subject:{type:"string",errorMessage:"The 'subject' field must be a string."}},required:["match","captured","subject"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'capture' object.",required:"All properties ('match', 'captured', 'subject') are required in the 'capture' object."}},runFunction:{type:"object",properties:{path:{type:"string",errorMessage:"The 'path' field must be a string."},name:{type:["string","null"],errorMessage:"The 'name' field can be a string or null."}},required:["path"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'runFunction' object.",required:"The 'path' field is required in the 'runFunction' object."}},setCache:{oneOf:[{type:"string",errorMessage:"The 'setCache' field must be a string."},{type:"object",properties:{name:{type:"string",errorMessage:"The 'name' field must be a string."},browser_cache_settings_maximum_ttl:{type:"number",nullable:!0,errorMessage:"The 'browser_cache_settings_maximum_ttl' field must be a number or null."},cdn_cache_settings_maximum_ttl:{type:"number",nullable:!0,errorMessage:"The 'cdn_cache_settings_maximum_ttl' field must be a number or null."}},required:["name"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the cache object.",required:"The 'name' field is required in the cache object."}}],errorMessage:"The 'cache' field must be either a string or an object with specified properties."}},additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'behavior' object."}}},required:["name","match"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in request items.",required:"The 'name' and 'match' fields are required in each request item."}}},response:{type:"array",items:{type:"object",properties:{name:{type:"string",errorMessage:"The 'name' field must be a string."},description:{type:"string",errorMessage:"The 'description' field must be a string."},active:{type:"boolean",default:!0,errorMessage:"The 'active' field must be a boolean."},match:{type:"string",errorMessage:"The 'match' field must be a string."},variable:{type:"string",errorMessage:"The 'variable' field must be a string."},behavior:{type:"object",properties:{setCookie:{type:["string","null"],errorMessage:"The 'setCookie' field must be a string or null."},setHeaders:{type:"array",items:{type:"string",errorMessage:"Each item in 'setHeaders' must be a string."},errorMessage:{type:"The 'setHeaders' field must be an array of strings."}},deliver:{type:["boolean","null"],errorMessage:"The 'deliver' field must be a boolean or null."},capture:{type:"object",properties:{match:{type:"string",errorMessage:"The 'match' field must be a string."},captured:{type:"string",errorMessage:"The 'captured' field must be a string."},subject:{type:"string",errorMessage:"The 'subject' field must be a string."}},required:["match","captured","subject"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'capture' object.",required:"All properties ('match', 'captured', 'subject') are required in the 'capture' object."}},enableGZIP:{type:["boolean","null"],errorMessage:"The 'enableGZIP' field must be a boolean or null."},filterCookie:{type:["string","null"],errorMessage:"The 'filterCookie' field must be a string or null."},filterHeader:{type:["string","null"],errorMessage:"The 'filterHeader' field must be a string or null."},runFunction:{type:"object",properties:{path:{type:"string",errorMessage:"The 'path' field must be a string."},name:{type:["string","null"],errorMessage:"The 'name' field can be a string or null."}},required:["path"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'runFunction' object.",required:"The 'path' field is required in the 'runFunction' object."}},redirectTo301:{type:["string","null"],errorMessage:"The 'redirectTo301' field must be a string or null."},redirectTo302:{type:["string","null"],errorMessage:"The 'redirectTo302' field must be a string or null."}},additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'behavior' object."}}},required:["name","match"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in response items.",required:"The 'name' and 'match' fields are required in each response item."}}}},anyOf:[{required:["request"]},{required:["response"]}],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the 'rules' object.",anyOf:"Either 'request' or 'response' must be provided."}},networkList:{type:"array",items:{type:"object",properties:{id:{type:"number",errorMessage:"The 'id' field must be a number."},listType:{type:"string",errorMessage:"The 'listType' field must be a string."},listContent:{type:"array",items:{type:"string",errorMessage:"The 'listContent' field must be an array of strings."}}},required:["id","listType","listContent"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in network list items.",required:"The 'id, listType and listContent' fields are required in each network list item."}}},domain:{type:"object",properties:{name:{type:"string",errorMessage:"The 'name' field must be a string."},cnameAccessOnly:{type:"boolean",errorMessage:"The 'cnameAccessOnly' field must be a boolean."},cnames:{type:"array",items:{type:"string",errorMessage:"Each item in 'cnames' must be a string."},errorMessage:{type:"The 'cnames' field must be an array of strings."}},edgeApplicationId:{type:"number",errorMessage:"The 'edgeApplicationId' field must be a number."},edgeFirewallId:{type:"number",errorMessage:"The 'edgeFirewallId' field must be a number."},digitalCertificateId:{type:["string","number","null"],errorMessage:"The 'digitalCertificateId' field must be a string, number or null. If string, it must be 'lets_encrypt'."},mtls:{type:"object",properties:{verification:{type:"string",enum:["enforce","permissive"],errorMessage:"The 'verification' field must be a string."},trustedCaCertificateId:{type:"number",errorMessage:"The 'trustedCaCertificateId' field must be a number."},crlList:{type:"array",items:{type:"number",errorMessage:"Each item in 'crlList' must be a number."},errorMessage:{type:"The 'crlList' field must be an array of numbers."}}},required:["verification","trustedCaCertificateId"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the mtls object.",required:"The 'verification and trustedCaCertificateId' fields are required in the mtls object."}}},required:["name"],additionalProperties:!1,errorMessage:{type:"The 'domain' field must be an object.",additionalProperties:"No additional properties are allowed in the domain object.",required:"The 'name' field is required in the domain object."}},purge:{type:"array",items:{type:"object",properties:{type:{type:"string",enum:["url","cachekey","wildcard"],errorMessage:"The 'type' field must be either 'url', 'cachekey' or 'wildcard'."},urls:{type:"array",items:{type:"string",errorMessage:"Each item in 'urls' must be a string."},errorMessage:{type:"The 'urls' field must be an array of strings."}},method:{type:"string",enum:["delete"],errorMessage:"The 'method' field must be either 'delete'. Default is 'delete'."},layer:{type:"string",enum:["edge_caching","l2_caching"],errorMessage:"The 'layer' field must be either 'edge_caching' or 'l2_caching'. Default is 'edge_caching'."}},required:["type","urls"],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in purge items.",required:"The 'type and urls' fields are required in each purge item."}}}},required:[],additionalProperties:!1,errorMessage:{additionalProperties:"No additional properties are allowed in the configuration object.",required:"The 'rules' section is required in the configuration object."}},M=B;var c=class{generate(i,t){return t}},l=c;var u=class extends l{generate(i){let t=_optionalChain([i, 'optionalAccess', _2 => _2.build]);return t||{}}},w=u;var _mathjs = require('mathjs');var m=class extends l{generate(i){let t=e=>{if(typeof e=="number")return e;if(/^[0-9+\-*/.() ]+$/.test(e))return _mathjs.evaluate.call(void 0, e);throw new Error(`Expression is not purely mathematical: ${e}`)},s=[];return!Array.isArray(_optionalChain([i, 'optionalAccess', _3 => _3.cache]))||_optionalChain([i, 'optionalAccess', _4 => _4.cache, 'access', _5 => _5.length])===0||_optionalChain([i, 'optionalAccess', _6 => _6.cache, 'access', _7 => _7.forEach, 'call', _8 => _8(e=>{let a=_optionalChain([e, 'optionalAccess', _9 => _9.browser])?t(e.browser.maxAgeSeconds):0,n=_optionalChain([e, 'optionalAccess', _10 => _10.edge])?t(e.edge.maxAgeSeconds):60,o={name:e.name,browser_cache_settings:_optionalChain([e, 'optionalAccess', _11 => _11.browser])?"override":"honor",browser_cache_settings_maximum_ttl:a,cdn_cache_settings:_optionalChain([e, 'optionalAccess', _12 => _12.edge])?"override":"honor",cdn_cache_settings_maximum_ttl:n,enable_caching_for_post:_optionalChain([e, 'optionalAccess', _13 => _13.methods, 'optionalAccess', _14 => _14.post])||!1,enable_caching_for_options:_optionalChain([e, 'optionalAccess', _15 => _15.methods, 'optionalAccess', _16 => _16.options])||!1,enable_query_string_sort:_optionalChain([e, 'optionalAccess', _17 => _17.queryStringSort])||!1};e.cacheByQueryString&&(o.cache_by_query_string=e.cacheByQueryString.option==="varies"?"all":e.cacheByQueryString.option,e.cacheByQueryString.option==="whitelist"||e.cacheByQueryString.option==="blacklist"?o.query_string_fields=e.cacheByQueryString.list||[]:o.query_string_fields=[]),e.cacheByCookie&&(o.cache_by_cookie=e.cacheByCookie.option==="varies"?"all":e.cacheByCookie.option,e.cacheByCookie.option==="whitelist"||e.cacheByCookie.option==="blacklist"?o.cookie_names=e.cacheByCookie.list||[]:o.cookie_names=[]),s.push(o)})]),s}},j=m;var g=class extends l{generate(i){let t=_optionalChain([i, 'optionalAccess', _18 => _18.domain]);if(!t)return{};if(t.digitalCertificateId&&typeof t.digitalCertificateId=="string"&&t.digitalCertificateId!=="lets_encrypt")throw new Error(`Domain ${t.name} has an invalid digital certificate ID: ${t.digitalCertificateId}. Only 'lets_encrypt' or null is supported.`);if(_optionalChain([t, 'access', _19 => _19.mtls, 'optionalAccess', _20 => _20.verification])&&t.mtls.verification!=="enforce"&&t.mtls.verification!=="permissive")throw new Error(`Domain ${t.name} has an invalid verification value: ${t.mtls.verification}. Only 'enforce' or 'permissive' is supported.`);let s={name:t.name,cname_access_only:t.cnameAccessOnly||!1,cnames:t.cnames||[],digital_certificate_id:t.digitalCertificateId||null,edge_application_id:t.edgeApplicationId||null,edge_firewall_id:t.edgeFirewallId||null,active:!0};return t.mtls?(s.is_mtls_enabled=!0,s.mtls_verification=t.mtls.verification,s.mtls_trusted_ca_certificate_id=t.mtls.trustedCaCertificateId,s.crl_list=t.mtls.crlList||[]):s.is_mtls_enabled=!1,s}},q=g;var h=class extends l{generate(i){let t=[];if(!Array.isArray(_optionalChain([i, 'optionalAccess', _21 => _21.origin]))||_optionalChain([i, 'optionalAccess', _22 => _22.origin, 'access', _23 => _23.length])===0)return t;let s=["single_origin","object_storage","load_balancer","live_ingest"];return _optionalChain([i, 'optionalAccess', _24 => _24.origin, 'access', _25 => _25.forEach, 'call', _26 => _26(e=>{if(s.indexOf(e.type)===-1)throw new Error(`Rule setOrigin originType '${e.type}' is not supported`);let a={id:e.id,key:e.key,name:e.name,origin_type:e.type};if(e.type!=="object_storage"){if(e.path==="/")throw new Error('Origin path cannot be "/". Please use empty string or "/path"');if(a.origin_path=e.path||"",a.origin_protocol_policy=e.protocolPolicy||"preserve",a.method=e.method||"ip_hash",a.is_origin_redirection_enabled=e.redirection||!1,a.connection_timeout=e.connectionTimeout||60,a.timeout_between_bytes=e.timeoutBetweenBytes||120,e.addresses&&e.addresses.length>0){let n=[];_optionalChain([e, 'optionalAccess', _27 => _27.addresses, 'access', _28 => _28.forEach, 'call', _29 => _29(o=>{if(typeof o=="string"){n.push({address:o});return}if(_optionalChain([o, 'optionalAccess', _30 => _30.weight])<0||_optionalChain([o, 'optionalAccess', _31 => _31.weight])>10)throw new Error(`When origin type is ${e.type}, weight must be between 0 and 10`);n.push(o)})]),a.addresses=n}else throw new Error(`When origin type is ${e.type}, addresses is required`);a.host_header=e.hostHeader||"${host}",_optionalChain([e, 'optionalAccess', _32 => _32.hmac])&&(a.hmac_authentication=!0,a.hmac_region_name=_optionalChain([e, 'access', _33 => _33.hmac, 'optionalAccess', _34 => _34.region]),a.hmac_access_key=_optionalChain([e, 'access', _35 => _35.hmac, 'optionalAccess', _36 => _36.accessKey]),a.hmac_secret_key=_optionalChain([e, 'access', _37 => _37.hmac, 'optionalAccess', _38 => _38.secretKey]))}else e.type==="object_storage"&&(a.bucket=e.bucket,a.prefix=e.prefix||"");t.push(a)})]),t}},C=h;var f=class extends l{generate(i){let t=[];return!Array.isArray(_optionalChain([i, 'optionalAccess', _39 => _39.purge]))||_optionalChain([i, 'optionalAccess', _40 => _40.purge, 'access', _41 => _41.length])===0||_optionalChain([i, 'optionalAccess', _42 => _42.purge, 'access', _43 => _43.forEach, 'call', _44 => _44(s=>{_optionalChain([s, 'optionalAccess', _45 => _45.urls, 'access', _46 => _46.forEach, 'call', _47 => _47(a=>{if(!a.includes("http://")&&!a.includes("https://"))throw new Error("The URL must contain the protocol (http:// or https://).");if(_optionalChain([s, 'optionalAccess', _48 => _48.type])==="wildcard"&&!a.includes("*"))throw new Error("The URL must not contain the wildcard character (*).")})]);let e={type:s.type,urls:s.urls||[],method:s.method||"delete"};_optionalChain([s, 'optionalAccess', _49 => _49.type])==="cachekey"&&(e.layer=s.layer||"edge_caching"),t.push(e)})]),t}},v=f;var P={setOrigin:{transform:(r,i)=>{let t=i.origin.find(s=>s.name===r.name&&s.origin_type===r.type);if(t){if(t.origin_type!==r.type)throw new Error(`Rule setOrigin originType '${r.type}' does not match the origin settings`)}else throw new Error(`Rule setOrigin name '${r.name}' not found in the origin settings`);return{name:"set_origin",target:t.name}}},rewrite:{transform:r=>{let i=[];return i.push({name:"rewrite_request",target:r}),i}},deliver:{transform:()=>({name:"deliver",target:null})},setCookie:{transform:r=>({name:"add_request_cookie",target:r})},setHeaders:{transform:r=>r.map(i=>({name:"add_request_header",target:i}))},setCache:{transform:(r,i)=>{if(typeof r=="string")return{name:"set_cache_policy",target:r};if(typeof r=="object"){let t={name:r.name,...r};return i.cache.push(t),{name:"set_cache_policy",target:r.name}}}},forwardCookies:{transform:r=>{if(r)return{name:"forward_cookies",target:null}}},runFunction:{transform:r=>({name:"run_function",target:r.path})},enableGZIP:{transform:r=>{if(r)return{name:"enable_gzip",target:""}}},bypassCache:{transform:r=>{if(r)return{name:"bypass_cache_phase",target:null}}},httpToHttps:{transform:r=>{if(r)return{name:"redirect_http_to_https",target:null}}},redirectTo301:{transform:r=>({name:"redirect_to_301",target:r})},redirectTo302:{transform:r=>({name:"redirect_to_302",target:r})},capture:{transform:r=>({name:"capture_match_groups",target:{regex:r.match,captured_array:r.captured,subject:`\${${_nullishCoalesce(r.subject, () => ("uri"))}}`}})}},k={setCookie:{transform:r=>({name:"set_cookie",target:r})},setHeaders:{transform:r=>r.map(i=>({name:"add_response_header",target:i}))},enableGZIP:{transform:r=>{if(r)return{name:"enable_gzip",target:""}}},filterCookie:{transform:r=>({name:"filter_response_cookie",target:r})},filterHeader:{transform:r=>({name:"filter_response_header",target:r})},runFunction:{transform:r=>({name:"run_function",target:r.path})},redirectTo301:{transform:r=>({name:"redirect_to_301",target:r})},redirectTo302:{transform:r=>({name:"redirect_to_302",target:r})},capture:{transform:r=>({name:"capture_match_groups",target:{regex:r.match,captured_array:r.captured,subject:`\${${_nullishCoalesce(r.subject, () => ("uri"))}}`}})}};var y=class extends l{addBehaviors(i,t,s,e){t&&typeof t=="object"&&Object.entries(t).forEach(([a,n])=>{if(s[a]){let o=s[a].transform(n,e);Array.isArray(o)?i.behaviors.push(...o):o&&i.behaviors.push(o)}else console.warn(`Unknown behavior: ${a}`)})}generate(i,t){let s=[];return Array.isArray(_optionalChain([i, 'optionalAccess', _50 => _50.rules, 'optionalAccess', _51 => _51.request]))&&_optionalChain([i, 'optionalAccess', _52 => _52.rules, 'optionalAccess', _53 => _53.request, 'optionalAccess', _54 => _54.forEach, 'call', _55 => _55((e,a)=>{let n={name:e.name,phase:"request",description:_nullishCoalesce(e.description, () => ("")),is_active:e.active!==void 0?e.active:!0,order:a+2,criteria:[[{variable:`\${${_nullishCoalesce(e.variable, () => ("uri"))}}`,operator:"matches",conditional:"if",input_value:e.match}]],behaviors:[]};this.addBehaviors(n,e.behavior,P,t),s.push(n)})]),Array.isArray(_optionalChain([i, 'optionalAccess', _56 => _56.rules, 'optionalAccess', _57 => _57.response]))&&_optionalChain([i, 'optionalAccess', _58 => _58.rules, 'optionalAccess', _59 => _59.response, 'access', _60 => _60.forEach, 'call', _61 => _61((e,a)=>{let n={name:e.name,phase:"response",description:_nullishCoalesce(e.description, () => ("")),is_active:e.active!==void 0?e.active:!0,order:a+2,criteria:[[{variable:`\${${_nullishCoalesce(e.variable, () => ("uri"))}}`,operator:"matches",conditional:"if",input_value:e.match}]],behaviors:[]};this.addBehaviors(n,e.behavior,k,t),s.push(n)})]),s}},A=y;var b=class{constructor(){this.strategies={}}setStrategy(i,t){this.strategies[i]=t}generate(i,t){return Object.keys(this.strategies).forEach(s=>{t[s]=this.strategies[s].generate(i,t)}),t}},S=b;function _(r){let i=new (0, _ajv2.default)({allErrors:!0,$data:!0,allowUnionTypes:!0});_ajverrors2.default.call(void 0, i),_ajvkeywords2.default.call(void 0, i,["instanceof"]);let t=i.compile(M);if(!t(r))throw t.errors&&t.errors.length>0?new Error(t.errors[0].message):new Error("Configuration validation failed.")}function I(r){let i=T(r);_(i);let t={},s=new S;return s.setStrategy("build",new w),s.setStrategy("origin",new C),s.setStrategy("cache",new j),s.setStrategy("domain",new q),s.setStrategy("purge",new v),s.setStrategy("rules",new A),s.generate(i,t),t}function ye(r){return _(r),r}exports.defineConfig = ye; exports.processConfig = I;
