"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var a=process.env.AZION_ENV==="stage"?"https://stage-api.azion.com/v4/edge/purge":"https://api.azion.com/v4/edge/purge",m=(n,r,o)=>{let e={message:"Error unknown",operation:o};return n.forEach(s=>{r[s]&&(e={message:Array.isArray(r[s])?r[s].join(", "):r[s],operation:o})}),e},u=async(n,r,o)=>g(`${a}/url`,n,r,o),c=async(n,r,o)=>g(`${a}/cachekey`,n,r,o),P=async(n,r,o)=>g(`${a}/wildcard`,n,r,o),g=async(n,r,o,e)=>{try{let t=await(await fetch(n,{method:"POST",headers:{Authorization:`Token ${r}`,"Content-Type":"application/json",Accept:"application/json; version=3"},credentials:"include",body:JSON.stringify({items:o,layer:"edge_cache"})})).json();return t.data?(e&&console.log("Response:",t),t):(e&&console.log("Response Error:",t),t.error=m(["detail","error","items"],t,"post purge"),{error:_nullishCoalesce(t.error, () => (JSON.stringify(t)))})}catch(s){throw e&&console.error("Error purging:",s),s}};var d=process.env.AZION_DEBUG&&process.env.AZION_DEBUG==="true",i=n=>_nullishCoalesce(_nullishCoalesce(n, () => (process.env.AZION_TOKEN)), () => ("")),p=n=>_nullishCoalesce(n, () => (!!d)),A=async(n,r,o)=>{let e=await u(i(n),r,p(_optionalChain([o, 'optionalAccess', _ => _.debug])));return _optionalChain([e, 'optionalAccess', _2 => _2.data])&&e.state?{data:{items:e.data.items,state:e.state}}:{error:e.error}},l=async(n,r,o)=>{let e=await c(i(n),r,p(_optionalChain([o, 'optionalAccess', _3 => _3.debug])));return _optionalChain([e, 'optionalAccess', _4 => _4.data])&&e.state?{data:{items:e.data.items,state:e.state}}:{error:e.error}},z=async(n,r,o)=>{let e=await P(i(n),r,p(_optionalChain([o, 'optionalAccess', _5 => _5.debug])));return _optionalChain([e, 'optionalAccess', _6 => _6.data])&&e.state?{data:{items:e.data.items,state:e.state}}:{error:e.error}},h= exports.purgeURL =(n,r)=>A(i(),n,r),O= exports.purgeCacheKey =(n,r)=>l(i(),n,r),f= exports.purgeWildCard =(n,r)=>z(i(),n,r),C= exports.createClient =n=>{let r=i(_optionalChain([n, 'optionalAccess', _7 => _7.token]));return{purgeURL:(e,s)=>A(r,e,s),purgeCacheKey:(e,s)=>l(r,e,s),purgeWildCard:(e,s)=>z(r,e,s)}};var v=C;exports.createClient = C; exports.default = v; exports.purgeCacheKey = O; exports.purgeURL = h; exports.purgeWildCard = f;
